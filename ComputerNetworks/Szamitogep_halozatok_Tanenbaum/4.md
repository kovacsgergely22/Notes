# 4. A közeg-hozzáférési-alréteg {#4}

![4](images/4.png)
![4v1](images/4v1.png)
![4v2](images/4v2.png)

***Hálózatok:***

1. Kétpontos összeköttetés
2. Adatszóró csatorna

Ez a fejezet adatszóró csatornákkal foglalkozik.

**Kulcskérdés**: versenyhelyzetben melyik csatorna nyerje el az adás jogát.

*Egyéb elnevezések adatszóró hálózatokra:*

1. Többszörös hozzáférésű csatorna (multiaccess channel)
2. Véletlen hozzáférésű csatorna (random access channel)

***Az adatkapcsolati réteg MAC (Medium Access Control – közeg-hozzáférési alréteg):***

* Azok a protokollok, amelyek az adatszóró csatorna használatának vezérléséért felelnek.
* Vezeték nélküli LAN hálózatok
* MAC-alréteg az adatkapcsolati réteg legalsó részét képezi (logikailag kétpontos előtt lenne)

## 4.1 A csatornakiosztás problémája {#4.1}

![4.1](images/4.1.png)

***A hálózatok kategóriái***

* Kétpontos összeköttetést használók (2. fejezetben)
* Adatszóró csatornát használók (itt)

***Adatszóró hálózat***

**Kulcskérdés:** Versenyhelyzetben ki adjon?

* **Adatszóró csatorna** (broadcast channel) = **többszörös hozzáférésű csatorna** (multiaccess channel) = **véletlen hozzáférésű csatorna** (random access channel)
* **MAC-alréteghez** (*Medium Access Control - közeghozzáférési alréteg*) tartoznak azok a protokollok, amelyek az adatszóró csatorna használatát vezérlik
* **Fő téma**: hálózat vezérlése
* Technikailag a MAC-alréteg az adatkapcsolati réteg alsó része, logikailag 3. fejezet lett volna
* Hogyan lehet egy adatszóró csatornát a versengő felek között kiosztani?
  * Csatorna lehet:
    * rádiós spektrum egy szelete
    * egy földrajzi régióban rézezeték, optikai kábel több csatlakozási ponttal
    * *A csatorna minden esetben fizikai összeköttetést biztosít a hozzá csatlakozó felhasználók között -> aktív felhasználó zavarja a többit*

### 4.1.1. Statikus csatornakiosztás {#4.2.1}

* Felosztás: csatorna kapacitását több részre bontjuk valamelyik nyalábolási módszerrel pl FDM (2.5. szakaszban)
* Ha sok küldő fél és löketes jellegű adatforgalom -> problémák

***Frekvenciaosztásos nyalábolás (FDM, Frequency Division Multiplexing)***

* N felhasználó, n sáv -> saját frekvenciasáv pl. FM rádióállomások
* Sok küldő fél, folyamatosan változik a forgalom -> löketes jellegű adatforgalom -> FDM nem hatékony

***Időosztásos nyalábolás (TDM, Time Divison Multiplexing)***
N felhasználó, n időszelet

### 4.1.2. Dinamikus csatornakiosztás {#4.1.2}

***Előfeltevések:***

1. Független forgalom: n független állomás (station)
2. Egyetlen csatorna
3. Megfigyelhető ütközések (collision): minden állomás képes észlelni ezeket és újraküldeni
4. Folytonos idő vagy diszkrét idő (slotted time) keretek továbbítása bármelyik időpillanatban vagy idő diszkrét szeletekre osztva.
5. Vivőjel érzékelés (carrier sense), vagy nincs vivőjel érzékelés
   * Szeletelt időkezelés, központi órával, szinkronizálás
   * Vezetékes hálózatok -> vivőjel érzékeléses
   * Vezeték nélküli hálózatok -> nem mindig hatékony vivőjel -> nem minden állomás esik bele a többi állomás hatósugarába -> Vivőjel egyáltalán nem használható, ha a két állomás nem tud közvetlenül kommunikálni egymással -> egyetlen többszörös hozzáférésű hálózat sem biztosít megbízható átvitelt -> adatkapcsolati rétegek felelősek a megbízhatóságért

## 4.2. Többszörös hozzáférésű protokollok {#4.2}

![4.2](images/4.2.png)

### 4.2.1. ALOHA {#4.2.1}

* Hawaii-szigetek -> elszigeteltség, kábeles hálózat nincs ->
* rövid hatótávú rádió, minden felhasználó közösen ugyanazt a felirányú (upstream) frekvenciasávot használta a központi számítógéphez keretek továbbítására

*Két változata:*

1. Egyszerű (pure) ALOHA
2. Időszeletelt (slotted) ALOHA

**Különbség:** időt folytonosnak veszik, vagy diszkrét időszeletekre osztottnak.

#### 4.2.1.1 Egyszerű ALOHA {#4.2.1.1}

* Engedjük a felhasználót adni, amikor van továbbítandó adata -> ütközések lesznek, keretek el fognak veszni. -> küldőnek meg kell tudni állapítani ezt.
* Állomás elküldi a keretét a központi számítógépnek -> utóbbi a vett keretet adatszórással visszaküldi minden állomásnak -> küldő állomás figyeli ezt, hogy kerete átjutott-e (más rendszerekben, pl. vezetékes LAN-okban a küldő képes lehet ütközésérzékelésre a küldés alatt)
* Ha a keret megsérült, a küldő véletlenszerű ideig vár, majd újraküldi. (véletlenszerű, hogy ne legyen ütközés újra és újra)
* Azok a rendszerek, amelyekben a közös csatorna használata konfliktushelyzetek kialakulásához vezethez, versenyhelyzetes (contention) rendszerek

**Keretgenerálás:**

* Keretek egyforma hosszúak, az ALOHA átbocsátóképessége egyforma keretméretek esetén maximális
* Két keret egyszerre -> ütközés -> mindkét csomag megsérül. Ellenőrzőösszeg számítás, nem különböztet meg teljes ütközést a részlegestől
* Áteresztőképesség és forgalmi igény kapcsolata: legjobb csatornakihasználtság, legfeljebb 18 %

![4.2.1.1](images/4.2.1.1.png)

#### 4.2.1.2. Időszeletelt ALOHA {#4.2.1.2}

* Egyszerű ALOHA kapacitásának megduplázása
* Időt diszkrét szeletekre (slot) kell osztani, melyek hossza a keretidőkhöz igazodik
* Megegyezés időintervallumok pontos helyében -> szinkronizálás -> egyik lehetséges módja: egyetlen speciális állomás, mely mint egy óra, ütemező jelet bocsát ki minden időintervallum kezdetén -> időszeletelt (vagy réselt) ALOHA (slotted ALOHA)
* Az állomások nem kezdhetnek el adni bármikor, meg kell várni következő időszelet kezdetét
* 1970-ben kidolgozták, kísérleti rendszerekben használták, majd feledésbe merült.
* Jelentősége:
  * Internet kábelen történő elérése -> rengeteg versengő felhasználó ->megoldás: időszeletelt ALOHA
  * RFID: több RFID címke egy olvasónak küld jelet -> időszeletelt ALOHA alapján

### 4.2.2. Vivőjel-érzékeléses többszörös hozzáférésű protokollok {#4.2.2}

* Tovább növelik a csatorna teljesítőképességét

Azokat a protokollokat, amelyekben az állomások figyelik a csatornán folyó forgalmat, és ennek megfelelően cselekszenek, **vivőjel-érzékeléses protokolloknak (carrier sense protocols)** nevezzük. Ezek:

* *Perzisztens és nemperzisztens CSMA*
  * *1 perzisztens CSMA (Carrier Sense Multiple Access – vivőjel-érzékeléses többszörös hozzáférés)*
  * *Nemperzisztens CSMA (nonpersistent CSMA)*
  * *P-perzisztens CSMA (p-persistent CSMA)*
* *CSMA ütközésérzékeléssel (Carrier Sense Multiple Access with Collision Detection)*

#### 4.2.2.1 Perzisztens és nem perzisztens CSMA {#4.2.2.1}

1. ***1-perzisztens CSMA***
   * Állomás adni készül -> belehallgat a csatornába
     * Ha szabad -> elküldi kereteit
     * Ha foglalt -> vár, amíg ismét szabad lesz a csatorna ->
   * elküld egy keretet
     * Ütközés -> véletlen hosszú ideig vár, majd újrakezdi az egészet.
   * 1 perzisztens, mert a várakozó állomás 1 valószínűséggel adni kezd, ha szabad a csatorna
   * Ha két állomás adni készül, mindkettő végigvárja a harmadik adását, majd egyszerre adni kezd -> ütközés
2. Nemperzisztens CSMA
   * Állomás adni készül -> belehallgat a csatornába
     * Ha szabad -> elküldi kereteit
     * Ha foglalt -> nem figyeli folyamatosan a csatornát, hanem véletlen hosszú ideig vár, majd újrakezdi az algoritmust
   * Jobb kihasználtság, de nagyobb késleltetés
3. P-perzisztens CSMA
   * Időszeletelt csatornát alkalmaz
   * Állomás adni készül -> belehallgat a csatornába
     * Ha szabad ->
       * p valószínűséggel elküldi kereteit ->
       * q=1-p valószínűséggel nem ad a következő időszeletig, majd elölről az algoritmus -> ameddig el nem küldi a keretet, vagy másik állomás adni nem kezd ->
       * Ütközésként értékeli -> véletlen ideig vár, majd újrakezdi az algoritmust
   * Ha foglalt -> vár a következő időszeletig, újrakezdi az algoritmust

![4.2.2](images/4.2.2.png)

#### 4.2.2.2. CSMA ütközésérzékeléssel {#4.2.2.2}

***CSMA/CD (Carrier Sense Multiple Access with Collision Detection):***

* Klasszikus Ethernet LAN-ok alapja
* t0  : keretküldés befejezése
* Állomások elkezdhetnek adni
  * Ha több egyszerre -> ütközés -> félbehagyja az adást, véletlen hosszú ideig vár, majd újrapróbál
* Ha két állomás t0 időpillanatban ad -> ütközés érzékeléséhez szükséges minimális idő az, ami alatt a jel az egyik állomástól a másikig eljut ->
* Feltételezhetjük, hogy az állomás a teljes terjedési idő letelte után (ha nem észlel ütközést addig) megszerzi a kábel használati jogát. -> legrosszabb esetben teljes terjedési idő 2-szerese kell ehhez
* CSMA/CD = 2-szeres terjedési idő réshosszúságú ALOHA. Különbség: foglalt időszeletekben az adó kereteinek további részei követik ->
* hatékonyabb, ha a keretidő jóval hosszabb a terjedési időnél

### 4.2.3. Ütközésmentes protokollok {#4.2.3}

CSMA/CD esetén nincs ütközés, ha egy állomás már egyértelműen megszerezte a csatornát -> versengési szakaszban még lehetnek ütközések -> rendszer teljesítőképessége romlik -> CSMA/CD sem mindenhol alkalmazható, nem feltétlenül ideális valós idejű forgalom számára, mint IP-n hangátvitel (VoIP)

Ütközés nélküli protokollok (még a versengési periódusban is):

1. **Helyfoglalásos protokoll**
2. **Vezérjeles gyűrűprotokoll**
3. **Bináris visszaszámlálás protokoll**

#### 4.2.3.1. Helyfoglalásos protokoll {#4.2.3.1}

***Alapvető bittérkép-eljárás (basic bit-map method)***

* Ütköztetési periódus pontosan n időszeletből áll -> minden állomásnak időszelet, amiben jelezheti adási szándékát (1-est küld ha adni akar, 0-t ha nem) -> ekkor a többi állomás nem használhatja a csatornát
* Az állomások időszeleteinek letelte után az adni kívánó állomások sorrendben adhatnak.
* Állomások sorrendje fix -> nincs ütközés

![4.2.3.1](images/4.2.3.1.png)

Azokat a protokollokat, melyekben a forgalmazási igényt a tényleges adatátvitel előtt kell adatszórással (broadcast) jelezni, helyfoglalásos protokolloknak (reservation protocol) nevezik (előre lefoglalják maguknak a csatornát, megelőzik az ütközést).

#### 4.2.3.2. Vezérjeles gyűrűprotokoll {#4.2.3.2}

**Vezérjel (token)**: rövid üzenet -> továbbadnak az állomások egymásnak előre meghatározott sorrendben -> adásra való jogosítás

1. **Vezérjeles gyűrűprotokoll (token ring protocol)**
   * Állomások egymás után gyűrűbe kapcsolva.
   * Keretek is vezérjel haladásának irányában továbbítódnak -> körben a gyűrű mentén és elérik a címzett állomást ->
   * hogy a keret ne menjen a végtelenségig a vezérgyűrűvel -> valamelyik állomásnak el kell távolítani a gyűrűről (küldő vagy célállomás)
2. **Vezérjeles sín protokoll (token bus)**
   * Nem szükséges kör alakúnak lennie, a vezérjel továbbadása mehet egy sínen is -> minden állomás a sínt használja, meghatározott sorrendben

A vezérjeles gyűrű protokollok, nagyjából változatlan formában MAC-protokollok -> *IEEE 802.5 „Token Ring”*
*RPR (Resilient Packet Ring – ellenálló csomagkapcsolt gyűrű) IEEE 802.17.*

#### 4.2.3.3. Bináris visszaszámlálás protokoll (binary countdown) {#4.2.3.3}

* Bináris, egyforma hosszú állomáscímek. ->
* Forgalmazni kívánó állomás adatszórással mindenkinek szétküldi a bináris címét, a legnagyobb helyi értékű bittel kezdve
* Ugyanabban a pillanatban elküldött címek azonos helyi értékű bitjeit a csatorna egymással logikai VAGY kapcsolatba hozza.
* Konfliktusok elkerülése érdekében kiegészítő szabály: ha egy állomás észleli, hogy 1-essel felül lett írva egy magasabb helyi értékű bitje, ami 0-s volt -> fel kell adnia a probálkozást.

***Összegezve:***
Kis terhelés esetén a versenyhelyzetes protokollok  (egyszerű és időszeletelt ALOHA) kedvezőbbek kis késleltetésük miatt. Ütközésmentes protokolloknál a fordítva, kis terhelés mellet viszonylag nagy késleltetés, a terhelés növekedésével a csatornakihasználtság javul (csatorna megszerzésével töltött idő rögzített).

### 4.2.4. Korlátozott versenyes protokollok {#4.2.4}
